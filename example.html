<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="vendor/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="lib/cpu.js"></script>
    <style>
      .pre {
        font-family: "Courier New";
        white-space: pre;
      }
    </style>
  </head>

  <body>

    <div id="hexprogram">
      <textarea id="hexinstructions"></textarea>
      <input id="run" type="button" value="Run">
    </div>

    <div id="registers">
      Registers:
      <div id="registervalues" class="pre"></div>
    </div>

    <div id="memory">
      Memory:
      <div id="memoryvalues" class="pre"></div>
    </div>


    <script type="text/javascript">
      $('document').ready(function() {

        var memory = [];
        for (var i = 0; i < 32; i++) { // 32 words for now
          memory.push(0x0000);
        }

        var getInstructions = function(element) {
          var text = element.val();
          var lines = text.split('\n');
          var instructions = [];
          lines.forEach(function(line) {
            line = line.trim();
            instructions.push(parseInt(line, 16));
          });
          return instructions;
        };

        var load = function(instructions) {
          var adress = 0x0;
          instructions.forEach(function(instruction) {
            memory[adress] = instruction;
            adress++;
          });
        };

        $('#run').click(function() {
          load(getInstructions($('#hexinstructions')));

          var cpu = new Cpu(memory);
          cpu.run(function(message) {
            if (message == 'step') {
              var text = '';
              cpu.registers.forEach(function(registerValue, registerNumber) {
                text += cpu.registerNames[registerNumber] + ': ' + registerValue + '\n';
                $("#registervalues").html(text);
              });
              text = '';
              var i = 0;
              memory.forEach(function(word) {
                text += word.toString() + ' ';
                if (i === 7) {
                  text += '\n';
                  i = 0;
                } else {
                  i++;
                }
                $("#memoryvalues").html(text);
              });
            }
          });
        });

      });
    </script>
  </body>
</html>
